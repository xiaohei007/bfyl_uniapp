{"version":3,"sources":["uni-app:///main.js","webpack:///E:/work/works/彬纷享你小程序/bfEnjoyYour/pages/personal/tankBottomCode/tankBottomCode.vue?1e10","webpack:///E:/work/works/彬纷享你小程序/bfEnjoyYour/pages/personal/tankBottomCode/tankBottomCode.vue?8ef9","webpack:///E:/work/works/彬纷享你小程序/bfEnjoyYour/pages/personal/tankBottomCode/tankBottomCode.vue?af94","webpack:///E:/work/works/彬纷享你小程序/bfEnjoyYour/pages/personal/tankBottomCode/tankBottomCode.vue?13a8","uni-app:///pages/personal/tankBottomCode/tankBottomCode.vue","webpack:///E:/work/works/彬纷享你小程序/bfEnjoyYour/pages/personal/tankBottomCode/tankBottomCode.vue?b9de","webpack:///E:/work/works/彬纷享你小程序/bfEnjoyYour/pages/personal/tankBottomCode/tankBottomCode.vue?e6f9"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,gI;AACAA,UAAU,CAACC,uBAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA2H;AAC3H;AACkE;AACL;AACc;;;AAG3E;AAC0L;AAC1L,gBAAgB,iMAAU;AAC1B,EAAE,oFAAM;AACR,EAAE,yFAAM;AACR,EAAE,kGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,6FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAitB,CAAgB,4tBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC6BruB;;;;;AAKA;;;;AAIA;;;;;AAKA;;;AAGA;AACA;;;;AAIA,2D;AACA,qB,CAAA;AACA,mB,CAAA;AACA,mB,CAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;eACA;AACA,QADA,kBACA,MADA,EACA;AACA;AACA;AACA;AACA,gCAJA,CAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GA7BA;AA8BA,MA9BA,kBA8BA;AACA;AACA,iBADA,EACA;AACA,gBAFA;AAGA,cAHA;;AAKA,GApCA;AAqCA,QArCA,oBAqCA;AACA;AACA;AACA;AACA;AACA,GA1CA;AA2CA;AACA,4DADA,CA3CA;;AA8CA;AACA;AACA,+CADA;AAEA,oCAFA,GADA;;AAKA;AACA,qDADA,GALA;;AAQA,QARA,kBAQA;AACA;AACA;AACA;AACA,SAHA;;AAKA,KAdA;AAeA;AACA,cAhBA,wBAgBA;AACA;AACA;AACA,sBADA;AAEA,iCAFA;AAGA,oBAHA;;AAKA,OANA,EAMA,GANA;AAOA,KAxBA;AAyBA,cAzBA,sBAyBA,QAzBA,EAyBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA,yBADA;AAEA,6BAFA;AAGA,wBAHA;AAIA;AACA;AACA,WANA;;AAQA;AACA;AACA;AACA;AACA;AACA,uBADA;AAEA,uBAFA;AAGA,UAHA,CAGA;AACA;AACA;AACA;AACA;AACA;AACA,6BADA;AAEA,mCAFA;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAPA,CAOA;AACA;AACA,2DADA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BADA;AAEA,2BAFA;AAGA,0BAHA;AAIA;AACA;AACA,aANA;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBADA;AAEA,0BAFA;AAGA,wBAHA;AAIA;AACA;AACA,WANA;;AAQA,OA7DA,EA6DA,KA7DA,CA6DA;AACA;AACA;AACA,OAhEA;AAiEA,KAxHA;AAyHA,eAzHA,yBAyHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAHA,MAGA;AACA;AACA;AACA;AACA,OATA,MASA;AACA;AACA,iCADA;AAEA,sBAFA;;AAIA;AACA,KA5IA;AA6IA,cA7IA,wBA6IA;AACA;AACA;AACA,KAhJA;AAiJA,eAjJA,yBAiJA;AACA;AACA;AACA;AACA;AACA;AACA,KAvJA;AAwJA,WAxJA,qBAwJA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,sBADA;AAEA,uBAFA;AAGA,8EAHA,EAGA;AACA,yEAJA,CAIA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBADA;AAEA,yDAFA;AAGA;AACA;AACA;AACA;AACA,mEADA;;AAGA;AACA,aAVA;;AAYA;AACA;AACA;AACA;AACA,uDADA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBADA;;AAGA;AACA;AACA,OA/CA;AAgDA,KAtNA;AAuNA;AACA,gBAxNA,0BAwNA;AACA;AACA;AACA;AACA;AACA,wCADA;AAEA,sCAFA;AAGA,sCAHA;AAIA,wCAJA;AAKA,0CALA;AAMA;AACA;AACA,+GADA;;AAGA,mCAJA,CAIA;AACA;AACA;AACA;AACA,0CARA,CAQA;AACA,SAfA;AAgBA;AACA;AACA;AACA,+BADA;AAEA,wCAFA;;AAIA;AACA;AACA;AACA,2BADA;AAEA,sCAFA;;AAIA,SA5BA;;AA8BA,KA1PA;AA2PA;AACA,aA5PA,uBA4PA;AACA;AACA,yBADA;AAEA,6BAFA;AAGA,+BAHA;AAIA,gCAJA;AAKA,gFALA;;AAOA,KApQA,GA9CA;;;AAqTA,UArTA,sBAqTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GA9TA,E;;;;;;;;;;;;;ACjEA;AAAA;AAAA;AAAA;AAAuyC,CAAgB,svCAAG,EAAC,C;;;;;;;;;;;ACA3zC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/personal/tankBottomCode/tankBottomCode.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/personal/tankBottomCode/tankBottomCode.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./tankBottomCode.vue?vue&type=template&id=5a9f284e&\"\nvar renderjs\nimport script from \"./tankBottomCode.vue?vue&type=script&lang=js&\"\nexport * from \"./tankBottomCode.vue?vue&type=script&lang=js&\"\nimport style0 from \"./tankBottomCode.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/personal/tankBottomCode/tankBottomCode.vue\"\nexport default component.exports","export * from \"-!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./tankBottomCode.vue?vue&type=template&id=5a9f284e&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./tankBottomCode.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./tankBottomCode.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"tank-bottom-code\">\r\n\t\t<!-- 相机自定义扫码 -->\r\n\t\t<!-- <xh-scan-code ref=\"xhScanCode\" :openNow=\"false\"/> -->\r\n\t\t<!-- 扫码按钮 -->\r\n\t\t<cover-image v-if=\"bidData.length<scanMax\" class=\"scan-btn\" src=\"../static/scan-b-btn.png\" @click=\"scan\">\r\n\t\t</cover-image>\r\n\t\t<!-- 重新支付 -->\r\n\t\t<repayments ref=\"repayments\" @closeNotice=\"closeNotice\" @repayments=\"wxPlayHandle\" />\r\n\t\t<!-- 消息提示 -->\r\n\t\t<xh-notify ref=\"xhNotify\" @frequently=\"frequently\"/>\r\n\t\t<!-- 进度 -->\r\n\t\t<xh-steps :steps=\"steps\" />\r\n\t\t<!-- 提示背景 -->\r\n\t\t<cover-view class=\"scan-tips\">\r\n\t\t\t<cover-view class=\"scan-tips-num\">已扫{{bidData.length}}次，总{{scanMax}}次</cover-view>\r\n\t\t\t<cover-view class=\"scan-tips-text\">\r\n\t\t\t\t<cover-view>扫中国红牛罐底二维码</cover-view>\r\n\t\t\t\t<cover-image class=\"scan-tips-logo\" src=\"../static/scan_bottom.png\"></cover-image>\r\n\t\t\t</cover-view>\r\n\t\t</cover-view>\r\n\t\t<!-- 遇到问题？-->\r\n\t\t<cover-view class=\"have-problem\" v-if=\"scanMax>0&&bidData.length===scanMax\" @click=\"haveProblem\">\r\n\t\t\t<cover-view class=\"have-problem-text\">支付问题点我</cover-view><cover-image  class=\"have-problem-icon\" src=\"../static/tips_red.png\"></cover-image>\r\n\t\t</cover-view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tmapGetters,\r\n\t\tmapActions,\r\n\t\tmapMutations\r\n\t} from 'vuex'\r\n\timport {\r\n\t\tcscanBotqr,\r\n\t\tcreatecardpay\r\n\t} from '@/api/homeApi.js'\r\n\timport {\r\n\t\tsetParmasData,\r\n\t\t// xhAudio,\r\n\t\tparseTime\r\n\t} from '@/utils/index.js'\r\n\timport {\r\n\t\tfileBaseUrl\r\n\t} from '@/utils/http.js'\r\n\timport log from '@/utils/log.js'\r\n\timport {\r\n\t\tsendMessage\r\n\t} from '@/utils/socket.js'\r\n\t\r\n\timport {setCheckCardVolume,getCheckCardVolume} from '@/utils/auth.js'\r\n\tlet _currCode = null //当前二维码code\r\n\tlet _scanData = [] //二维码值集合，防止重复数据\r\n\tlet _store_id = '' //门店ID\r\n\t//音频控制\r\n\t// let error_audio = null,\r\n\t// \twritten_audio = null,\r\n\t// \tswept_audio = null\r\n\t//统计相关\r\n\tlet _startTime = 0\r\n\t//微信支付参数\r\n\tlet _playParams = null\r\n\t//音频延时\r\n\t// let _audio_time = null\r\n\texport default {\r\n\t\tonLoad(option) {\r\n\t\t\t_currCode = ''\r\n\t\t\t_playParams = null\r\n\t\t\t_scanData = []\r\n\t\t\t_store_id = option.store_id //门店ID\r\n\t\t\t//最大扫码罐数\r\n\t\t\tthis.scanMax = Number(option.maxBottom) || this.checkCardVolume.length\r\n\t\t\t/*兼容代码*/\r\n\t\t\tif(this.scanMax == 0){\r\n\t\t\t\tthis.scanMax = getCheckCardVolume().length\r\n\t\t\t}\r\n\t\t\t/*兼容代码*/\r\n\t\t\t// //初始化音频\r\n\t\t\t// error_audio = xhAudio({ \r\n\t\t\t// \turl: fileBaseUrl + '/public/img/to2/cmp3/02/BFXN_MUSIC_07.mp3'\r\n\t\t\t// })\r\n\t\t\t// //已核销\r\n\t\t\t// written_audio = xhAudio({\r\n\t\t\t// \turl: fileBaseUrl + '/public/img/to2/cmp3/02/BFXN_MUSIC_08.mp3'\r\n\t\t\t// })\r\n\t\t\t// //已扫 \r\n\t\t\t// swept_audio = xhAudio({\r\n\t\t\t// \turl: fileBaseUrl + '/public/img/to2/cmp3/02/BFXN_MUSIC_09.mp3'\r\n\t\t\t// })\r\n\t\t\t//记录时间\r\n\t\t\t_startTime = parseTime(new Date(), '{y}-{m}-{d} {h}:{i}:{s}')\r\n\t\t\t//调取扫码\r\n\t\t\tthis.scan()\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tbidData: [], //罐码集合\r\n\t\t\t\tscanMax: 0,\r\n\t\t\t\tsteps: 1\r\n\t\t\t}\r\n\t\t},\r\n\t\tonHide() {\r\n\t\t\t// clearTimeout(_audio_time)\r\n\t\t\t// error_audio.stop()\r\n\t\t\t// written_audio.stop()\r\n\t\t\t// swept_audio.stop()\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t...mapGetters(['checkCardVolume', 'userLocation'])\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t...mapActions({\r\n\t\t\t\tgetCardTopCount: 'personal/getCardTopCount',\r\n\t\t\t\tgetUserInfo: 'login/getUserInfo'\r\n\t\t\t}),\r\n\t\t\t...mapMutations({\r\n\t\t\t\tsetCheckCardVolume: 'personal/setCheckCardVolume'\r\n\t\t\t}),\r\n\t\t\tscan() {\r\n\t\t\t\twx.scanCode({\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tthis.onScancode(res.result)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//亲，您扫太快了，处理不过来\r\n\t\t\tfrequently(){\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ticon:'none',\r\n\t\t\t\t\t\ttitle:'亲，您扫太快了，处理不过来~',\r\n\t\t\t\t\t\tmask:true\r\n\t\t\t\t\t})\r\n\t\t\t\t},200)\r\n\t\t\t},\r\n\t\t\tonScancode(scanCode) {\r\n\t\t\t\t// console.log('scanCode ----->onScancode', scanCode)\r\n\t\t\t\t//扫罐码次数已用完情况 \r\n\t\t\t\tif (_scanData.length >= this.scanMax) return\r\n\t\t\t\t//值不为空说明当前code还未处理完，等处理完可继续扫码\r\n\t\t\t\tif (_currCode !== '') {\r\n\t\t\t\t\t\tthis.frequently()\r\n\t\t\t\t\t\treturn \r\n\t\t\t\t\t}\r\n\t\t\t\t//播放音效\r\n\t\t\t\t// this.$refs.xhScanCode.play()\r\n\t\t\t\t//获取扫描数据\r\n\t\t\t\t_currCode = scanCode\r\n\t\t\t\t//是否已被自己扫过\r\n\t\t\t\tif (_scanData.indexOf(_currCode) !== -1) {\r\n                   /* _audio_time = setTimeout(()=>{\r\n\t\t\t\t\t\tswept_audio.play()\r\n\t\t\t\t\t},1000) */\r\n\t\t\t\t\treturn this.$refs.xhNotify.show({\r\n\t\t\t\t\t\ttype: 'warning',\r\n\t\t\t\t\t\tmessage: '您已扫过该罐底码',\r\n\t\t\t\t\t\tduration: 1500,\r\n\t\t\t\t\t\tonClose:function(){\r\n\t\t\t\t\t\t\t_currCode = ''\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\t//当前this对象\r\n\t\t\t\tlet _this = this\r\n\t\t\t\t//请求后端判断是否为无效码\r\n\t\t\t\tcscanBotqr({\r\n\t\t\t\t\tcode: _currCode,\r\n\t\t\t\t\t...this.userLocation\r\n\t\t\t\t}).then(function(res){\r\n\t\t\t\t\tif (res.code == 1) {\r\n\t\t\t\t\t\t//添加到扫码集合\r\n\t\t\t\t\t\t_scanData.push(_currCode)\r\n\t\t\t\t\t\t //存储二维码值\r\n\t\t\t\t\t\t_this.bidData.push({\r\n\t\t\t\t\t\t\tbid: res.data.bid,\r\n\t\t\t\t\t\t\tbot_qr: res.data.bot_qr\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t//达到要求发起支付\r\n\t\t\t\t\t\tif (_this.bidData.length == _this.scanMax) {\r\n\t\t\t\t\t\t\ttry{\r\n\t\t\t\t\t\t\t\t//支付\r\n\t\t\t\t\t\t\t\t_this.payment()\r\n\t\t\t\t\t\t\t\t//扫码成功 上报数据\r\n\t\t\t\t\t\t\t\t_this.reporting()\r\n\t\t\t\t\t\t\t\t//罐底码扫码成功\r\n\t\t\t\t\t\t\t\t_this.steps = 2\r\n\t\t\t\t\t\t\t}catch(e){\r\n\t\t\t\t\t\t\t\t_this.$refs.repayments.show({\r\n\t\t\t\t\t\t\t\t\tmsg: '意外情况导致失败，点击“重新支付”重新尝试,若无效可截图，并联系客服处理'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tlog.setFilterMsg('支付异常')\r\n\t\t\t\t\t\t\t\tlog.error(\"requestPayment error==>\" + JSON.stringify(e))\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//扫码成功提示\r\n\t\t\t\t\t\t_this.$refs.xhNotify.show({\r\n\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\tmessage: '扫描成功',\r\n\t\t\t\t\t\t\tduration: 1500,\r\n\t\t\t\t\t\t\tonClose:function(){\r\n\t\t\t\t\t\t\t\t_currCode = ''\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//音效\r\n\t\t\t\t\t// if (res.data && res.data.code == 3) {\r\n\t\t\t\t\t// \t_audio_time = setTimeout(()=>{\r\n\t\t\t\t\t// \t\terror_audio.play()\r\n\t\t\t\t\t// \t},1000)\r\n\t\t\t\t\t// }\r\n\t\t\t\t\t// if (res.data && res.data.code == 1) {\r\n\t\t\t\t\t// \t_audio_time = setTimeout(()=>{\r\n\t\t\t\t\t// \t\twritten_audio.play()\r\n\t\t\t\t\t// \t},1000)\r\n\t\t\t\t\t// }\r\n\t\t\t\t\t//失败情况\t\t\r\n\t\t\t\t\t_this.$refs.xhNotify.show({\r\n\t\t\t\t\t\ttype: 'danger',\r\n\t\t\t\t\t\tmessage: res.msg,\r\n\t\t\t\t\t\tduration: 1500,\r\n\t\t\t\t\t\tonClose:function(){\r\n\t\t\t\t\t\t\t_currCode = ''\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}).catch(err => {\r\n\t\t\t\t\t//置空\r\n\t\t\t\t\t_currCode = ''\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\thaveProblem(){\r\n\t\t\t\tlet len1 = getCheckCardVolume().length\r\n\t\t\t\tlet len2 = this.bidData.length\r\n\t\t\t\t//判断现有支付条件漫步满足\r\n\t\t\t\tif(_store_id&&len1>0&&len1===len2){\r\n\t\t\t\t\t //是否有支付参数\r\n\t\t\t\t\t if(_playParams){\r\n\t\t\t\t\t\t //直接支付\r\n\t\t\t\t\t\t this.wxPlayHandle()\r\n\t\t\t\t\t }else{\r\n\t\t\t\t\t\t //创建新支付\r\n\t\t\t\t\t\t this.payment()\r\n\t\t\t\t\t }\r\n\t\t\t\t}else{\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle:'未能解决问题，请联系客服反馈',\r\n\t\t\t\t\t\ticon:'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\trepayments() { //重新支付\r\n\t\t\t\tthis.$refs.repayments.onlyClose()\r\n\t\t\t\tthis.payment()\r\n\t\t\t},\r\n\t\t\tcloseNotice() { //重新支付弹窗关闭回调\r\n\t\t\t   this.$refs.repayments.onlyClose()\r\n\t\t\t\t// uni.redirectTo({\r\n\t\t\t\t// \turl: '/pages/personal/myCardBag/index'\r\n\t\t\t\t// })\r\n\t\t\t\t// this.setCheckCardVolume([])\r\n\t\t\t},\r\n\t\t\tpayment() { //发起支付\r\n\t\t\t\t//关闭扫码防止性能问题\r\n\t\t\t\t// this.$refs.xhScanCode.close()\r\n\t\t\t\t/*兼容代码*/\r\n\t\t\t\tlet checkCardVolume =  getCheckCardVolume()\r\n\t\t\t\t\r\n\t\t\t\t/*兼容代码*/\r\n\t\t\t\tlet parmas = {\r\n\t\t\t\t\tsid: _store_id, //门店ID\r\n\t\t\t\t\t...this.userLocation,\r\n\t\t\t\t\tpull_arr: setParmasData(checkCardVolume, 'pull_qr', 'pid'), //拉环兑换卷id数组\r\n\t\t\t\t\tbot_arr: setParmasData(this.bidData, 'bot_qr', 'bid') //罐底码id数组\r\n\t\t\t\t}\r\n\t\t\t\t//微信支付\r\n\t\t\t\tcreatecardpay(parmas).then(res => {\r\n\t\t\t\t\t//正常支付\r\n\t\t\t\t\tif(res.code == 1){\r\n\t\t\t\t\t\t//保存支付参数\r\n\t\t\t\t\t\t_playParams = res.data\r\n\t\t\t\t\t\t//调用支付\r\n\t\t\t\t\t\tthis.wxPlayHandle()\r\n\t\t\t\t\t\treturn \r\n\t\t\t\t\t}\r\n\t\t\t\t\t//错误信息\r\n\t\t\t\t\tlet message =  res.msg\r\n\t\t\t\t\t//手机号未绑定\r\n\t\t\t\t\tif (message === '手机号未绑定') {\r\n\t\t\t\t\t\t//更新本地用户信息\r\n\t\t\t\t\t\tthis.getUserInfo()\r\n\t\t\t\t\t\t//引导用户\r\n\t\t\t\t\t\treturn uni.showModal({\r\n\t\t\t\t\t\t\ttitle: '温馨提示',\r\n\t\t\t\t\t\t\tcontent: '意外导致手机号未绑定成功，无法发起支付，确认回到我的卡包重新发起兑换',\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\t\t//跳转\r\n\t\t\t\t\t\t\t\t\tuni.reLaunch({\r\n\t\t\t\t\t\t\t\t\t\turl: '/pages/personal/myCardBag/index?currTabs=0'\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//输出日志\r\n\t\t\t\t\tif(JSON.stringify(parmas.pull_arr) === \"{}\"){\r\n\t\t\t\t\t\tthis.$refs.repayments.show({\r\n\t\t\t\t\t\t\tmsg: '意外情况导致失败，点击“重新支付”重新尝试,若无效可截图，并联系客服处理'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tlog.setFilterMsg('支付异常2')\r\n\t\t\t\t\t\tlog.info(\"location=>\"+JSON.stringify(this.userLocation))\r\n\t\t\t\t\t\tlog.info(\"requestPayment error==>\"+JSON.stringify(parmas))\r\n\t\t\t\t\t\tlog.info(\"checkCardVolume==>\"+JSON.stringify(checkCardVolume))\r\n\t\t\t\t\t\tlog.error(\"checkCardVolume==>\"+JSON.stringify(message))\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//其它情况\r\n\t\t\t\t\tthis.$refs.repayments.show({\r\n\t\t\t\t\t\tmsg: message\r\n\t\t\t\t\t})\r\n\t\t\t\t\t//更新本地用户信息 \r\n\t\t\t\t\tthis.getUserInfo()\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//微信支付处理\r\n\t\t\twxPlayHandle() {\r\n\t\t\t\tif (!_playParams) {\r\n\t\t\t\t\treturn this.payment()\r\n\t\t\t\t}\r\n\t\t\t\tuni.requestPayment({\r\n\t\t\t\t\t\"nonceStr\": _playParams.nonceStr,\r\n\t\t\t\t\t\"package\": _playParams.package,\r\n\t\t\t\t\t\"paySign\": _playParams.paySign,\r\n\t\t\t\t\t\"signType\": _playParams.signType,\r\n\t\t\t\t\t\"timeStamp\": _playParams.timeStamp,\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tuni.reLaunch({\r\n\t\t\t\t\t\t\turl: `/pages/personal/exchangeCode/index?codeData=${_playParams.qr_code}&isplay=1&type=1`\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tthis.getCardTopCount() //更新顶部状态\r\n\t\t\t\t\t\tlog.setFilterMsg('支付成功')\r\n\t\t\t\t\t\tlog.info(\"requestPayment success==>\" + JSON.stringify(res))\r\n\t\t\t\t\t\tthis.setCheckCardVolume([])\r\n\t\t\t\t\t\tsetCheckCardVolume()//传空等于清除\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tif (err.errMsg == 'requestPayment:fail cancel') {\r\n\t\t\t\t\t\t\treturn this.$refs.repayments.show({\r\n\t\t\t\t\t\t\t\tmsg: '您已取消兑换支付操作',\r\n\t\t\t\t\t\t\t\torder: _playParams.qr_code\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//其它提示\r\n\t\t\t\t\t\tthis.$refs.repayments.show({\r\n\t\t\t\t\t\t\tmsg: err.errMsg,\r\n\t\t\t\t\t\t\torder: _playParams.qr_code\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t/*数据上报*/\r\n\t\t\treporting() {\r\n\t\t\t\tsendMessage({\r\n\t\t\t\t\t\"type\": \"Clog-gd\",\r\n\t\t\t\t\t\"count\": this.scanMax,\r\n\t\t\t\t\t\"num\": _scanData.length,\r\n\t\t\t\t\t\"start_time\": _startTime,\r\n\t\t\t\t\t\"end_time\": parseTime(new Date(), '{y}-{m}-{d} {h}:{i}:{s}')\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\t//中间退出了扫罐底码流程\r\n\t\t\tif (_scanData.length < this.scanMax) {\r\n\t\t\t\tthis.reporting()\r\n\t\t\t}\r\n\t\t\t// clearTimeout(_audio_time)\r\n\t\t\t// error_audio.destroy()\r\n\t\t\t// written_audio.destroy()\r\n\t\t\t// swept_audio.destroy()\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t.tank-bottom-code {\r\n\t\tposition: absolute;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tbottom: 0;\r\n\t\ttop: 0;\r\n\t\tbackground-color: #333;\r\n\r\n\t\t.scan-tips {\r\n\t\t\tposition: fixed;\r\n\t\t\tleft: 0;\r\n\t\t\tbottom: 0;\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 348rpx;\r\n\t\t\tbackground-color: #44924F;\r\n\t\t}\r\n\r\n\t\t.scan-tips-text {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: center;\r\n\t\t\talign-items: center;\r\n\t\t\tcolor: #FFFFFF;\r\n\t\t\tfont-size: 40rpx;\r\n\t\t\tmargin-top: 128rpx;\r\n\t\t}\r\n\r\n\t\t.scan-tips-logo {\r\n\t\t\twidth: 140rpx;\r\n\t\t\theight: 144rpx;\r\n\t\t\tmargin-left: 28rpx;\r\n\t\t}\r\n\r\n\t\t.scan-tips-num {\r\n\t\t\tcolor: #FFFFFF;\r\n\t\t\tposition: absolute;\r\n\t\t\ttop: 20rpx;\r\n\t\t\tleft: 0;\r\n\t\t\twidth: 100%;\r\n\t\t\ttext-align: center;\r\n\t\t}\r\n\r\n\t\t.scan-btn {\r\n\t\t\tposition: absolute;\r\n\t\t\twidth: 260rpx;\r\n\t\t\theight: 91rpx;\r\n\t\t\tleft: 50%;\r\n\t\t\tbottom: 400rpx;\r\n\t\t\ttransform: translateX(-50%);\r\n\t\t}\r\n\t\t.have-problem{\r\n\t\t\twidth: 220rpx;\r\n\t\t\theight: 50rpx;\r\n\t\t\tpadding-left: 24rpx;\r\n\t\t\tpadding-right: 10rpx;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tbackground-color: #FFE4E1;\r\n\t\t\tposition: fixed;\r\n\t\t\tbottom: 240rpx;\r\n\t\t\tright: 0;\r\n\t\t\tz-index: 1;\r\n\t\t\tborder-radius: 15px 0 0 15px;\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: space-between;\r\n\t\t\talign-items: center;\r\n\t\t}\r\n\t\t.have-problem-text{\r\n\t\t\tfont-size: 24rpx;\r\n\t\t\tcolor: #FE2821;\r\n\t\t}\r\n\t\t.have-problem-icon{\r\n\t\t\twidth: 28rpx;\r\n\t\t\theight: 28rpx;\r\n\t\t\tmargin-left: 10rpx;\r\n\t\t}\r\n\t}\r\n</style>\n","import mod from \"-!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./tankBottomCode.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\TXC\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./tankBottomCode.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1624255046840\n      var cssReload = require(\"C:/Users/TXC/Desktop/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}